# MCPContext - Complete Documentation Index

## ğŸ“ Files Created

All files located in: `/Users/kooshapari/temp-prodvercel/485/clean/deploy/atoms.tech/src/contexts/`

### Core Implementation
1. **MCPContext.tsx** (17KB, 615 lines)
   - Main context implementation
   - Production-ready with full TypeScript support
   - Includes all features: multi-provider, auto-refresh, persistence, error handling

### Supporting Files
2. **index.ts** (340B)
   - Centralized exports for easy imports
   - Re-exports all types and hooks

3. **README.md** (10KB)
   - Comprehensive API documentation
   - Complete type definitions
   - Best practices and troubleshooting

4. **INTEGRATION_GUIDE.md** (13KB)
   - Step-by-step integration instructions
   - Complete code examples for each step
   - Common issues and solutions

5. **MCPContext.example.tsx** (11KB)
   - 9 real-world usage examples
   - Covers all common use cases
   - Copy-paste ready code

6. **MCPContext.test.tsx** (10KB)
   - Complete test suite
   - Demonstrates proper usage through tests
   - Covers all major functionality

7. **QUICK_REFERENCE.md** (4KB)
   - Cheat sheet for common operations
   - Quick lookup for API methods
   - Copy-paste snippets

## ğŸš€ Quick Start

```tsx
// 1. Wrap your app
import { MCPProvider } from '@/contexts';
<MCPProvider accessToken={token}>{children}</MCPProvider>

// 2. Use in components
import { useMCP } from '@/contexts';
const { connect, disconnect, isConnectionActive } = useMCP();
await connect('github', 'my-integration');
```

## ğŸ“š Documentation Roadmap

### New to MCP Context?
1. Start with **QUICK_REFERENCE.md** (5 min read)
2. Follow **INTEGRATION_GUIDE.md** (30 min)
3. Reference **README.md** as needed

### Implementing Features?
1. Browse **MCPContext.example.tsx** for patterns
2. Copy relevant examples
3. Adapt to your use case

### Writing Tests?
1. Review **MCPContext.test.tsx**
2. Use as template for your tests
3. Follow testing patterns shown

## ğŸ¯ Key Features

### âœ… Implemented
- [x] Multi-provider OAuth connections (GitHub, Google, Azure, Auth0)
- [x] Automatic token refresh (5 min before expiry)
- [x] Persistent storage (localStorage)
- [x] Connection restoration on mount
- [x] Active connection management
- [x] Comprehensive error handling
- [x] TypeScript support (100% typed)
- [x] Loading states
- [x] Connection status checks
- [x] Batch operations (refresh all)
- [x] OAuth popup flow
- [x] Window message handling
- [x] Retry logic with exponential backoff
- [x] Safe component unmounting
- [x] Memory leak prevention

### ğŸ”’ Security Features
- [x] Tokens not stored in localStorage (only metadata)
- [x] Secure OAuth flow
- [x] Token expiration checks
- [x] PKCE support (via useMCPOAuth)
- [x] Origin validation for messages

## ğŸ“– Interface Reference

### Main Hook: `useMCP()`

**Returns:**
```typescript
{
  // State
  connections: MCPConnectionState;
  activeConnection: MCPConnection | null;
  isLoading: boolean;
  error: string | null;
  isInitialized: boolean;

  // Methods
  connect(provider, mcpName): Promise<void>;
  disconnect(provider, mcpName): Promise<void>;
  refreshConnection(provider, mcpName): Promise<void>;
  refreshAllConnections(): Promise<void>;
  setActiveConnection(provider, mcpName): void;
  getConnection(provider, mcpName): MCPConnection | null;
  listConnections(): MCPConnection[];
  clearError(): void;
  isConnectionActive(provider, mcpName): boolean;
  hasAnyConnection(): boolean;
}
```

### Types
```typescript
type OAuthProvider = 'github' | 'google' | 'azure' | 'auth0';

interface MCPConnection {
  provider: OAuthProvider;
  mcpName: string;
  isConnected: boolean;
  token: OAuthToken | null;
  connectedAt: number;
  lastRefreshedAt?: number;
  error?: string;
}

interface OAuthToken {
  access_token: string;
  refresh_token?: string;
  expires_at: string;
  token_type: string;
  scope: string;
  provider: OAuthProvider;
  mcp_name: string;
}
```

## ğŸ”§ Configuration

### Provider Props
```typescript
interface MCPProviderProps {
  children: React.ReactNode;
  accessToken?: string;        // User's auth token
  autoRefresh?: boolean;        // Default: true
}
```

### Storage Keys
- `mcp_connections` - Connection metadata
- `mcp_active_connection` - Active connection identifier

## ğŸ“Š Architecture

```
MCPProvider
â”œâ”€â”€ useMCPOAuth (underlying OAuth hook)
â”œâ”€â”€ State Management
â”‚   â”œâ”€â”€ connections (all connections)
â”‚   â”œâ”€â”€ activeConnection (current active)
â”‚   â”œâ”€â”€ isLoading (operation state)
â”‚   â”œâ”€â”€ error (error state)
â”‚   â””â”€â”€ isInitialized (ready state)
â”œâ”€â”€ Effects
â”‚   â”œâ”€â”€ Initialize on mount
â”‚   â”œâ”€â”€ Auto-refresh interval
â”‚   â”œâ”€â”€ OAuth callback handler
â”‚   â”œâ”€â”€ Window message listener
â”‚   â””â”€â”€ Storage sync
â””â”€â”€ Methods (12 public methods)
```

## ğŸ¨ Examples Overview

1. **AppLayout** - Basic provider setup
2. **MCPConnectionButton** - Connect/disconnect UI
3. **MCPConnectionsList** - List all connections
4. **MCPRefreshButton** - Manual token refresh
5. **MCPStatusIndicator** - Status display
6. **MCPErrorHandler** - Error handling
7. **MCPApiCall** - Using tokens in API calls
8. **MultiProviderConnector** - Multiple providers
9. **OptionalMCPFeature** - Conditional MCP features

## ğŸ§ª Testing

Test suite includes:
- Provider initialization
- Connection management
- Active connection handling
- Connection status checks
- Token refresh
- Error handling
- localStorage integration
- Auto-refresh behavior
- Multiple providers
- Helper functions

## ğŸ› Troubleshooting

| Issue | Solution | Reference |
|-------|----------|-----------|
| Tokens not persisting | Check accessToken prop | README.md |
| OAuth popup blocked | User permissions | INTEGRATION_GUIDE.md |
| Auto-refresh not working | Verify autoRefresh=true | README.md |
| Multiple connections failing | Use unique mcpNames | QUICK_REFERENCE.md |

## ğŸ“ Usage Statistics

- **Total Lines of Code**: 615 (main file)
- **Total Documentation**: ~50KB
- **Number of Examples**: 9
- **Number of Tests**: 15+
- **Type Safety**: 100%
- **Browser Support**: Modern browsers (localStorage required)

## ğŸ”— Dependencies

Required:
- React 18+
- TypeScript 4.5+
- Next.js 13+ (for 'use client')
- `@/hooks/useMCPOAuth`
- `@/types/mcp/oauth.types`

## ğŸ“ Learning Path

### Beginner (15 min)
1. Read QUICK_REFERENCE.md
2. Copy Example 1 (AppLayout)
3. Try connecting to one provider

### Intermediate (1 hour)
1. Follow INTEGRATION_GUIDE.md
2. Implement MCPConnectionManager
3. Add error handling
4. Test with multiple providers

### Advanced (2+ hours)
1. Review full README.md
2. Study all 9 examples
3. Write custom hooks
4. Implement comprehensive tests
5. Add advanced features

## ğŸ“® Support & Contributing

For issues, improvements, or questions:
- Review documentation thoroughly
- Check examples for similar use cases
- Consult integration guide
- Contact atoms.tech development team

## ğŸ“„ License

Part of atoms.tech project - proprietary license

---

**Created**: October 23, 2024  
**Version**: 1.0.0  
**Author**: Claude (Anthropic)  
**Location**: `/Users/kooshapari/temp-prodvercel/485/clean/deploy/atoms.tech/src/contexts/`
